<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="#" />
    <title>STAGE DEV: Blippar WebAR SDK</title>

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    <!-- Step 1: Include WebAR SDK script -->
    <script src="webar-sdk/webar-sdk-v2.0.8.min.js"
            webar-mode="marker-tracking"
            auto-init="false"
            auto-start="true"
            logo-src="images/test_logo_here.png"
            logo-width="116px"
            logo-height="116px"
            progress-dot-ring-scale="0.30"
            progress-dot-ring-color="#00AAFF"
            progress-ring-scale="0.36"
            progress-ring-color="#00FFFF"
            progress-ring-line-width="5"
            alert-border-color="#00FFFF"
            alert-border-width="5px"
            alert-background-color="#283747"
            alert-message-text-color="#00AAFF"
            alert-button-color="#00FFFF"
            alert-button-text-color="#283747"
            alert-button-height="50px"
            alert-camera-permission-text="We need to ask for access to the camera so this experience can work!!!"
            alert-camera-permission-button-text="No Problem"
            alert-motion-permission-text="Now we need access to motion sensors!!!"
            alert-motion-permission-button-text="No Problem"
            alert-box-width="290px"
            alert-box-height="182px"
            alert-box-font-size="24px"
            ui-background-color="#283747"
            ui-text-color="#00FFFF"
            desktop-logo-src="images/test_desktop_logo.png"
            desktop-logo-width="108px"
            desktop-logo-height="30px"
            issue-img-src="images/test_issue_img.png"
            issue-img-width="116px"
            issue-img-height="116px"
            show-guide-view="true"
            auto-marker-detection="true"
            auto-scan-instruction="Look for a marker to scan..."
            auto-scan-instruction-detect="Detecting..."
            auto-scan-instruction-idle="Move around to look for a marker"
            auto-scan-instruction-text-style="color: orange"
            auto-scan-style="display: none; position: absolute; top: 90%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; width: auto; height: auto; text-align: center;"
            auto-scan-style-display="block"
            scan-btn-width="100"
            scan-btn-height="100"
            scan-btn-display="block"
            scan-btn-instruction="Tap to scan"
            scan-btn-instruction-style="color: white"
            scan-btn-img-src="images/user_scan-btn-image_here.png"
            scan-btn-img-width="50"
            scan-btn-img-height="50"
            scan-btn-img-x-coordinate="50%"
            scan-btn-img-y-coordinate="50%"
            scan-btn-img-transform="translate(-25, -25)"
            scan-btn-progress-circle-cx-coordinate="50"
            scan-btn-progress-circle-cy-coordinate="50"
            scan-btn-progress-circle-radius="35"
            scan-btn-progress-circle-style="fill: none; stroke: cyan; stroke-width: 6;"
            scan-btn-progress-bar-cx-coordinate="50"
            scan-btn-progress-bar-cy-coordinate="50"
            scan-btn-progress-bar-radius="35"
            scan-btn-progress-bar-transform="rotate(-90 50 50)"
            scan-btn-progress-bar-color="blue"></script>
</head>

<body>

    <a-scene webar-scene="key: cf647511-9802-48ec-8bd2-0b0a0edb9001"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: false"
             loading-screen="enabled: false"
             renderer="colorManagement: true;">

        <a-camera webar-camera></a-camera>

        <!-- ASSETS -->
        <a-assets timeout="60000">
            <a-asset-item id="testmodel1" src="models/MaterialsVariantsShoe.glb"></a-asset-item>
            <a-asset-item id="testmodel2" src="models/astronaut.glb"></a-asset-item>

            <!-- ðŸŽ¬ Add your video here -->
            <video id="trackedVideo"
                   src="videos/demo.mp4"
                   preload="auto"
                   autoplay
                   loop
                   muted
                   playsinline
                   crossorigin="anonymous">
            </video>
        </a-assets>

        <!-- MARKER 1 WITH MODEL -->
        <a-entity webar-marker="id: b3ed7e4c-7423-44c0-8af1-63567b27a1e9">
            <a-entity gltf-model="#testmodel1" id="testmodel_1"
                      rotation="90 0 0" position="0 0 0" scale="5 5 5"
                      webar-loadmonitor="elType: glb">
            </a-entity>

            <!-- ðŸŽ¬ VIDEO PLANE (hidden initially) -->
            <a-video id="videoPlane"
                     src="#trackedVideo"
                     width="1.5"
                     height="0.85"
                     position="0 0.1 0"
                     rotation="-90 0 0"
                     visible="false">
            </a-video>
        </a-entity>

        <!-- MARKER 2 WITH MODEL -->
        <a-entity webar-marker="id: 7a9ca8e2-bf27-44c1-828d-6bca876bb7a7">
            <a-entity gltf-model="#testmodel2" id="testmodel_2"
                      rotation="0 0 0" position="0 -0.5 0" scale="0.25 0.25 0.25"
                      webar-loadmonitor="elType: glb">
            </a-entity>
        </a-entity>

    </a-scene>

    <script>
        WEBARSDK.Init();

        const video = document.getElementById("trackedVideo");
        const videoPlane = document.getElementById("videoPlane");

        WEBARSDK.SetMarkerDetectedCallback((markerId) => {
            console.log("Marker detected:", markerId);

            if (markerId === "be85b792-9b8c-4aaa-b249-ce64792aafbd") {

                videoPlane.setAttribute("visible", true);

                video.muted = false;   // allow audio
                video.currentTime = 0; // restart
                video.play().catch(err => {
                    console.warn("Video blocked until user taps screen", err);
                });
            }
        });

        WEBARSDK.SetMarkerLostCallback((markerId) => {
            console.log("Marker lost:", markerId);

            if (markerId === "be85b792-9b8c-4aaa-b249-ce64792aafbd") {
                video.pause();
                videoPlane.setAttribute("visible", false);
            }
        });
    </script>

</body>
</html>